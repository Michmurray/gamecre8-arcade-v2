<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>GameCre8 — Play</title>
<style>
  :root { --fg:#0b0b0f; --line:#e5e7eb; --ui:#f7f7f9; }
  *{box-sizing:border-box}
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#fff; color:var(--fg); }
  header { padding:10px 12px; border-bottom:1px solid var(--line); display:flex; gap:8px; align-items:center; }
  header input { flex:1; padding:8px 10px; font-size:14px; border:1px solid var(--line); border-radius:10px; }
  header button { padding:8px 12px; font-size:14px; border:1px solid var(--line); border-radius:10px; background:var(--ui); cursor:pointer }
  #hud { position:fixed; left:10px; top:58px; background:rgba(255,255,255,.92); border:1px solid var(--line); padding:8px 10px; border-radius:10px; font-size:12px; max-width:min(92vw,520px); }
  canvas { display:block; width:100vw; height:calc(100vh - 50px); }
</style>
<body>
  <header>
    <input id="prompt" placeholder="Describe a game…">
    <button id="playBtn">Play</button>
    <button id="shareBtn" title="Share link">Share</button>
    <button id="copyBtn" title="Copy link">Copy Link</button>
    <button id="home" onclick="location.href='/'">Home</button>
  </header>
  <div id="hud">Loading…</div>
  <canvas id="c"></canvas>

<script>
/* --- URL + UI --- */
const qs = new URLSearchParams(location.search);
const promptInput = document.getElementById('prompt');
promptInput.value = qs.get('prompt') || '';
document.getElementById('playBtn').onclick = () => {
  const p = promptInput.value.trim();
  location.href = `./play.html?prompt=${encodeURIComponent(p||'hello')}`;
};
/* Share/Copy link helpers */
function shareUrl(){ const p=encodeURIComponent(promptInput.value||'hello'); return `${location.origin}${location.pathname}?prompt=${p}`; }
document.getElementById('copyBtn').onclick = async ()=>{ await navigator.clipboard.writeText(shareUrl()); };
document.getElementById('shareBtn').onclick = async ()=>{ const url=shareUrl(); if(navigator.share){try{await navigator.share({title:'GameCre8',url})}catch{}} else { await navigator.clipboard.writeText(url); } };

/* Canvas setup */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha: false });
function fitCanvas(){ const w=innerWidth, h=Math.max(320, innerHeight-50); canvas.width=w; canvas.height=h; }
fitCanvas(); addEventListener('resize', fitCanvas);

/* HUD + defaults */
const hud = document.getElementById('hud');
const userPrompt = promptInput.value || 'hello';

/* Defaults (fallback if API fails) */
let CFG = { speed:3, gravity:0.7, theme:'light', platformRate:0.06, coinRate:0.05, hazardRate:0.03, jump:12, assets:{background:null, player:null} };

/* Helper to load an image safely */
function loadImage(src){ return new Promise((res,rej)=>{ const img=new Image(); img.onload=()=>res(img); img.onerror=()=>rej(new Error('load fail')); img.src=src; }); }

/* Fetch config + assets, then start */
let BG_IMG=null, PLAYER_IMG=null;
(async function bootstrap(){
  try {
    const res = await fetch('/api/generate?prompt=' + encodeURIComponent(userPrompt));
    const json = await res.json();
    if (json?.config) CFG = json.config;

    // Load images if present
    try { if (CFG.assets?.background) BG_IMG = await loadImage(CFG.assets.background); } catch {}
    try { if (CFG.assets?.player)     PLAYER_IMG = await loadImage(CFG.assets.player); } catch {}

    hud.textContent = `Prompt: "${userPrompt}" • theme=${CFG.theme} • speed=${CFG.speed} • gravity=${CFG.gravity} • jump=${CFG.jump}`;
  } catch {
    hud.textContent = `Prompt: "${userPrompt}" • (API fallb
