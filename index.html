<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GameCre8 â€” Fresh</title>
<body style="font-family:system-ui, sans-serif; max-width:780px; margin:3rem auto; padding:0 1rem">
  <h1 style="margin:0 0 .25rem">GameCre8 (Fresh)</h1>
  <p style="margin:.25rem 0 1rem;color:#444">
    Start typing and the game will auto-launch. You can also use direct links like
    <code>?prompt=...&autoplay=1</code>.
  </p>

  <input id="p" placeholder="Try: create a ninja platformer" style="width:100%;padding:12px;font-size:16px;border:1px solid #e5e7eb;border-radius:12px">
  <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; align-items:center">
    <button id="play" style="padding:10px 14px;font-size:16px;border:1px solid #e5e7eb;border-radius:12px;background:#f7f7f9;cursor:pointer">Play Now</button>
    <button id="go" style="padding:10px 14px;font-size:16px;border:1px solid #e5e7eb;border-radius:12px;background:#f7f7f9;cursor:pointer">Test API</button>
    <span style="flex:1"></span>
    <button id="surprise" title="Pick a random idea" style="padding:10px 14px;font-size:16px;border:1px solid #e5e7eb;border-radius:999px;background:#111;color:#fff;cursor:pointer">ðŸŽ² Surprise Me</button>
  </div>

  <div id="chips" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:14px"></div>

  <pre id="o" style="background:#f7f7f9;padding:12px;border-radius:12px;overflow:auto;margin-top:14px;border:1px solid #efefef">Readyâ€¦</pre>

  <script>
    const input = document.getElementById('p');
    const out = document.getElementById('o');
    const qs = new URLSearchParams(location.search);
    const urlPrompt = qs.get('prompt');
    const autoplay = qs.get('autoplay') === '1';

    // Helper: launch the playable page with the prompt
    function launchWith(text) {
      const q = encodeURIComponent(text || 'hello');
      location.href = '/play.html?prompt=' + q;
    }

    // Buttons still available (but no longer required)
    document.getElementById('play').onclick = () => launchWith(input.value);
    document.getElementById('go').onclick = async () => {
      const q = encodeURIComponent(input.value || 'hello');
      const r = await fetch('/api/generate?prompt=' + q);
      out.textContent = JSON.stringify(await r.json(), null, 2);
    };

    // Preset ideas + Surprise Me
    const PRESETS = [
      'create a ninja platformer',
      'space runner with low gravity and lava',
      'underwater swim to collect rings',
      'cozy kid-friendly game to collect gems',
      'pirate treasure island runner',
      'unicorn jumping on clouds collecting rings'
    ];
    const chips = document.getElementById('chips');
    PRESETS.forEach((text) => {
      const b = document.createElement('button');
      b.textContent = text;
      b.style = 'padding:8px 12px;font-size:14px;border:1px solid #e5e7eb;border-radius:16px;background:#fff;cursor:pointer';
      b.onclick = () => launchWith(text);
      chips.appendChild(b);
    });
    document.getElementById('surprise').onclick = () => {
      const pick = PRESETS[Math.floor(Math.random() * PRESETS.length)];
      launchWith(pick);
    };

    // Enter key = immediate launch
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') launchWith(input.value);
    });

    // Debounced auto-launch when typing stops (no click needed)
    let t;
    input.addEventListener('input', () => {
      clearTimeout(t);
      t = setTimeout(() => launchWith(input.value), 1000); // 1s pause â†’ go
    });

    // If URL already has a prompt, prefill and optionally autoplay
    if (urlPrompt) {
      input.value = urlPrompt;
      if (autoplay || !document.referrer) {
        // Autoplay for explicit flag, or when landing cold with a prompt
        launchWith(urlPrompt);
      }
    }
  </script>
</body>
</html>
